## 01.04.2020

- aws
  - code-star
    - 특징
      - 서버 구성, 빌드, 배포, 모니터링을 위한 통합 서비스이다.
      - 배포 환경의 서버 인프라 구성을 자동화하고자 한다면 적합하다.
      - 빌드 결과물을 생성하기 위해 jenkins 서버를 따로 운영한다면 좋은 대안이다.
      - 빌드를 위한 운영 비용을 줄이는데 좋다.
    - 과정
      - 프로세스 생성
        - ec2나 eb를 통해 용량 프로비저닝, 로드밸런싱, 크기조정부터 모니터링까지 배포를 자동으로 처리할 수 있다.
        - code-commit을 통해 안전한 git 저장소를 쉽게 호스팅할 수 있다. 소스코드에서 바이너리까지 모든 것을 안전하게 저장할 수 있고, 기존 git도구와 원활하게 연동할 수 있다.
      - 빌드
        - code-build를 통해 소스코드를 컴파일하는 단계부터 테스트 실행 후 소프트웨어 패키지를 배포한느 단계까지 마칠 수 있는 완전관리형 빌드 서비스이다.
      - 배포
        - code-pipeline
          - 코드 변경이 있을 때마다 사용자가 정의한 릴리즈 프로세스 모델에 따라 빌드, 테스트 및 배포가 가능하다.
          - 소스 저장소에 변경내역을 감지하는 것을 시작으로 배포하기까지의 일련의 흐름을 관리한다.
          - 애플리케이션을 짧은 주기로 지속적으로 통합하고 전달할 수 있도록 도와준다.
          - 기능과 업데이트를 신속하고 안정적으로 제공할 수 있다.
          - 지속적 전달과정에서 여러가지 테스트를 할 수 있는데, ui테스트, 로드테스트, 통합테스트, api안정성 테스트 등이 포함될 수 있다.
          - 온프레미스에서는 힘들었지만, 클라우드에서는 테스트용으로 여러개의 환경을 생성하고 복제하는 작업을 효율적인 비용으로 손쉽게 자동화할 수 있다.
      - 모니터링
        - cloud-watch를 이용해 지표를 수집 및 추적하고, 로그 파일을 통해 경보설정을 하고 aws 리소스 변경에 자동으로 대응이 가능하다.

## 02.04.2020

- push notification
  - app
    - `expo-permissions`을 호출하고, 푸시 api 엔드포인트를 상수로 선언한다.
    - 알림을 받기 위한 알림, 메시지를 상태로 선언한다.
    - 푸시알림 토큰을 서버에 등록하는 메서드를 만든다.
    - 서버에 토큰을 요청하기 전에 인가된 상태인지 확인하는 상태를`Permission.askAsync()`로 받아온다.
    - 인가되었다면 토큰을 `Notifications.getExpoPushTokenAsync()`로 받아온다.
    - 토큰이 적절하다면 엔드포인트를 사용해 등록을 위해 서버로 요청을 보낼 것이다.
    - 요청에는 토큰과 사용자를 객체에 담아 보낸다.
    - 토큰이 등록되면 애플리케이션에서 발생할 알림을 위한 event listener를 만든다.
    - 새로운 알림이 수신될 떄마다 event handler가 실행된다.
    - 나중에 렌더에서 사용하기 위해 콜백에 전달된 새로운 알림을 상태에 넘겨주면 된다.
    - 상태가 변경될때마다 렌더할 수 있도록 한다.
    - 보낼 메시지를 상태에 담아 보내는 코드도 작성한다.
  - server
    - 푸시알림을 보내주는 `expo-server-sdk`를 호출한다.
    - 앱에 등록된 토큰을 저장하기 위한 배열을 선언한다.
    - 서버에는 두 개의 엔드포인트가 필요하다.
      - 토큰을 등록하기 위한
      - 앱에서 메시지를 받아오기 위한
    - 토큰 등록함수를 작성한다.
    - 앱에서 받은 메시지를 푸시알림을 보내는 함수를 작성한다.
      - 토큰 배열을 순회하면서 토큰을 검증한다.
      - 검증된 토큰으로 메시지를 보낸다.
    - 메시지 배열을 받아오면 expo 서버로 전송한다.
    - expo 서버에 등록된 모든 기기에 푸시알림을 해준다.
    - `chunckPushNotifications()`, `sendPushNotificationsAsync()`를 통해 expo 서버에서 메시지 배열을 받는다.
    - `POST /token`로 토큰을 받아서 토큰을 수신했다는 응답을 반환한다.
    - `POST /message`로 메시지를 받아서 expo 서버로 전송해준다.
