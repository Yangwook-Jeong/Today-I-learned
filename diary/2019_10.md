# 오늘 배운 것을 정리하는 공간

## 30.09.2019

- [lambda](https://medium.com/@yumenohosi/aws-lambda-api-gateway-dynamodb-node-js-사용기-삽질기-b5352e00b396)

  - warm/cold start
    - lambda를 처음 호출하면 cold start를 한다. 이 경우 초기 지연시간이 발생한다.
    - warm 상태를 유지하며 이때는 lambda를 다시 호출해도 지연시간이 발생하지 않는다.
    - 5분 이상 호출되지 않는다면 cold 상태로 바뀐다.
  - handler

  ```js
  exports.handler = (event, context, callback) => {
  	// TODO implement
  	callback(null, 'Hello from Lambda')
  }
  ```

  - trigger
    - api gateway
      - [링크](https://hyunseob.github.io/2017/05/27/aws-lambda-easy-start/)에 설명이 나와있다.
      - http method를 만들어 lambda 함수를 연결시켜준다.
      - body에 실어 보내는 내용은 lambda 함수의 event 객체에 들어가 있다.
      - `node_modules`와 `index.js`를 zip으로 묶어서 lambda에 업로드하면 모든 절차가 끝난다.
      - entry file명은 반드시 `index.js`여야 한다.
    - dynamo db
      - trigger로 lambda에 연결해준다.
      - table 이름, pk를 적당히 입력한다.

- dynamo db

## 01.10.2019

- lambda가 data를 저장할 수 있는 영구계층을 제공한다.
- multi a-z(Available Zone) - 기존 서버 장애시 failover가 가능하다.
- cloud front - web contents를 사용자에게 더 빨리 배포하도록 지원하는 service이다.
- 시간이 오래 걸리는 작업은 비동기로 한다.
- db 이중화 - master/slave로 query, select를 분산시켜 db server의 부하를 줄이는 방법이다. - slave는 master의 binary log file을 참조하여 update하므로, slave server에 login해서 db를 update하면 동기화되지 않는다.

## 03.10.2019

- nodejs
  - node module
    - process env
      - os
      - process
      - cluster
    - address
      - fs
      - path
      - url
      - querystring
      - stream
    - network
      - http
      - https
      - net
      - dgram
      - dns
  - global object
    - Buffer
      - js는 binary data를 다루는 기능이 없다. 그래서 Buffer를 통해 data를 다룬다.
      - file에서 binary data를 얻을 수도 있고 network에서 socket을 통해 얻을 수도 있다.
      - 새로운 buffer를 만들려면 new키워드를 통해 만들며, size가 정해지면 바꿀 수 없다.
  - utility
    - 전역 객체가 아니므로 require()를 해야한다.
  - event
    - 마찬가지로 require()가 필요하다.

## 04.10.2019

- provisioning: it 인프라 자원을 사용자 또는 비즈니스의 요구사항에 맞게 할당, 배포해서 시스템을 사용할 수 있도록 만들어 놓는 것을 말한다.
- on-demand: 고객이 원하는 것을 즉시 해결해주는 새로운 정보산업 체제

## 06.10.2019

- nodejs

  - event

    - register
      - `.addListenr(name, fn)`
      - `.on(name, fn)`
      - `.once(name, fn)`
    - remove
      - `.removeListner(name, fn)`
      - `.removeAllListener(name)`
    - handler count
      - `.setMaxListeners(n)`
      - `.getMaxListeners()`
    - force emit
      - `.emit(name, fn)`: 성공시 `true`, 실패시 `false`를 반환한다.
    - custom event

      - `EventEmitter`객체를 new한 객체나 상속받은 객체에서는 custom event를 만들 수 있다.

      ```js
      const { EventEmitter } = require('evnet')
      const customeEvent = new EventEmitter()

      customEvent.on('tick', () => console.log('new event'))
      customEvent.emit('tick')
      ```

    - error handling
      - event listener 함수는 `fn(err, param)`의 형태를 띈다.

  - stream
    - console 입출력, file 읽기쓰기, server, client간의 data 송수신도 전부 stream이다.
    - stream을 다루기 위한 추상 interface이다.
    - 다양한 stream을 같은 interface로 다룰 수 있다.
    - Readable
      - `.read([size])`
      - `.setEncoding(encoding)`
      - `.pause()`
      - `resume()`
      - `pipe(dest[, options])`/`unpipe([dest])`
    - Writable
      - http 요청/응답
      - file 쓰기 stream
      - tcp socket
      - `setDefaultEncoding(encoding)`
      - `write(chunck[, encoding][, callback])`
      - `end([chunk][, encoding][, callback])`
      - `cork()`/`uncork()`
  - cluster
    - multi process, core를 사용할 수 있다.
    - nodejs application은 1개의 single thread로 돌아가다보니 quad core여도 25%밖에 사용하지 못한다.
    - cluster 사용 시 port를 공유한다.
    - core의 갯수만큼 사용할 수 있다.
    - clustering 기능 지원 pm은 pm2가 있다.
    - master
      - `fork()`: worker 생성 확인
      - `isMaster`
    - worker
      - `isWorker`
      - `worker`
      - `worker.id`
      - `worker.kill([signal='SIGTERM'])`
    - master-worker data i/o
      - `worker.send(data)`: master가 worker에게 data를 전달하며, worker는 message event를 발생시킨다.
      - ``process.send(data)`: worker가 master에게 data를 전달한다.

- libuv
  - 비동기 입출력, event 기반에 초점을 맞춘 library이다.
  - 전통적으로 io처리는 요청마다 thread를 사용하는 방식이다.
  - 하지만 libuv는 비동기, non blocking을 사용한다.
  - 이를 사용하기 위해 각 kernal의 비동기 io를 이용한다.
  - os의 비동기 event는 libuv의 event로 취급된다.
  - 예컨대 파일쓰기가 끝났다면 libuv층까지 전달되고 event loop에 callback이 등록된다.
