# 오늘 배운 것을 정리하는 공간

## 03.12.2019

- sql
	- `WHERE col_name BETWEEN col_date AND col_date_2`: 날짜 필터링 기능
	- `WHERE col_name IN (col_1, col_2, col_3)`: 한 컬럼에서 여러 키워드 검색 기능

- puppeteer
	- window.alert 강제로 끄기
		```js
		const page = await browser.newPage();  
	  
		page.on('dialog', async dialog => {  
		 console.log(`dialog message:' ${dialog.message()}`);  
		 await dialog.dismiss();  
		});
	```

## 06.12.2019

- sqs
	- Queue Attributes
		- Default Visibility Timeout: 특정 component에 전달된 뒤, 자동으로 삭제되지 않는다. 그래서 다른 component에서 중복된 msg를 전달받을 수 있는 문제가 발생하기 떄문에, 한번 전달된 msg는 timeout에 설정된 일정시간동안은 다시 전달되지 않도록 한다. 이러한 상태를 inflight라고 한다. (기본값 30초)
		- Message Retention Period: msg의 생명주기이다. (기본값 4일)
		- Maximum Message Size: msg의 최대크기이다. 비용과 관련된다. (기본값 256kb)
		- Delivery Delay: 새로운 msg가 전달되는 초기 지연시간이다.
		- Receive Message Wait Time: `receiveMessage`에서 long polling을 활성화할 수 있다.
			- Long Polling: `receiveMessage`가 호출되었을때, msg가 없으면 일정시간동안 msg가 도착할때까지 기다린 후, 새로운 msg가 도착하면 바로 msg를 return한다. msg가 없을때 empty response에 대한 비용을 절약할 수 있다. (기본값 Short Polling)
		- Content-Based Deduplication:  
	- Dead Letter Queue Settings: msg가 성공적으로 처리되지 못했을시 msg를 따로 처리할 수 있도록 도와준다. 
		- Use Redrive Policy
		- Dead Letter Queue
		- Maximum Receives
	- Server-Side Encrpytion (SSE) Settings
		- Use SSE
		- AWS KMS Customer Master Key (CMK): (기본값 aws/sqs)
		- Data Key Reuse Period: (기본값 5분)
	- msg: 반환되는 msg의 내용
		- msg body
		- msg body의 md5 digest
		- msg 전성시 사용된 MessageId
		- ReceiptHandle: msg 삭제시 identifier로 사용한다.
		- msg attributes
		- msg attributes의 md5 digest
	- sqs와 연결하기 위해 필요한 lambda role
		- sqs에게서 msg를 전달받고, 삭제할 수 있는 역할
		- lambda를 invoking 가능한 역할
		- cloud watch에 log를 생성할 수 있는 역할

- ElasticSearch
	- term
		- index: database
		- type: table
		- document: row
		- field: column
		- mapping: schema
		- sql: dsl
			- dsl(Domain Specific Language): 특정 영영을 타겟으로 하는 언어를 말한다. 
	- rest-api-request
		- `http://<host>:<port>/<index>/<type>/<action|id>`
	- 5.0 버전 이후부터는 `index` 별로 한개의 `type`만 가질 수 있다.
		> ### Multiple mapping types are not supported in indices created in 6.0
		> The ability to have multiple mapping types per index has been removed in 6.0. **New indices will be restricted to a single type.** This is the first step in the plan to remove mapping types altogether. Indices created in 5.x will continue to support multiple mapping types.

- ELK
	- ElasticSearch
		- port: 9200
		- config: 
			- `vim /etc/elasticsearch/elasticsearch.yml`
			- `network.host: <ip>`: 설정값은 모든 호스트 열어둠.  `0.0.0.0`
			- `discovery.seed_hosts: [<ip>]`: 설정값은 localhost로 됨. `["localhost", "127.0.0.1", "[::1]"]`
			- `xpack.security.enabled: false`
		- start
			- ElasticSearch가 작동중인 상태에서 실행해야한다.
			- `sudo -u elasticsearch /usr/share/elasticsearch/bin/elasticsearch`
			- `network.host`를 바꾸면 bootstrap checks failed 오류가 발생한다.
				- `discovery.seed_hosts`, `discovery.seed_providers`, `cluster.initial_master_nodes`변수를 설정해준다.
				-  `xpack.security.transport.ssl.enabled: true`혹은 `xpack.security.enabled: false`로 변경한다.
			- 혹은 service로 설정해뒀다면 `systemctl start elasticsearch.service`
		- upgrade
			- `POST /_ml/set_upgrade_mode?enabled=true`
	- LogStash
		- config
		- start
	- Kibana
		- port: 5601
		- config: `/etc/kibana/kibana.yml`
			- `server.host: <ip>`: private ip로 작성함.
		- start: `/usr/share/kibana/bin/kibana`
			- 혹은 service로 설정해뒀다면 `systemctl start kibana.service`

- ubuntu
	- `/usr/share/fonts/`: 폰트 설치 폴더
	- `dpkg -L <프로그램명>`: 프로그램 설치 여부 확인가능

- matplotlib 
	- `home/user/.local/lib/python3.6/site-packages/matplotlib/mpl-data/fonts/`: 폰트 설치 폴더
	- `home/user/.local/lib/python3.6/site-packages/matplotlib/mpl-data/matplotlibrc`: config 파일
	- `home/user/.cache/matplotlib/ fontlist-v310.json`: config 파일

- network
	- hostname
		- `127.0.0.1`: localhost
		- `192.168.*.*`/`172.16.*.*`: 
	- subnet과 supernet 차이점
	- ip주소 비트로 계산하기 === cidr 계산법

- linux
	- service등록하는 방법
		- 등록하면 무한 자동실행이 가능해진다
	- `killall sudo`
	- `ps -ef`
	- `/var/log/`: 로그 저장한 디렉토리

## 07.12.2019

- aws
	- services
		- computing
			- EC2 Container Registry: docker img를 배포한다. 
			- EC2 Container Service
				- 저장된 docker container를 실행 및 관리한다. 
				- ec2 scaling할때 docker에서 시작되어서 관리하기 좋다.
			- Elastic Beanstalk: 내부적으로 ec2 + elb와 같고 git에서 바로 배포도 가능하다.
		- storage & contents delivery
			- CloudFront
				- cdn 서비스이다.
				- 속도가 s3의 10배 정도의 빠른 속도를 가진다. 
			- EBS(Elastic Block Store)
				- ec2용 hdd이다.
				- ssd 없는 ec2 instance에는 필수라고 한다.
				- 1개의 ebs는 하나의 ec2에만 사용가능하다.
				- 하나의 ec2에는 여러개의 ebs를 갖는 것이 가능하다.
			- EFS(Elastic File System)
				- ec2의 공유 folder이다.
				- 여러대의 ec2에서 사용할 수 있다.
			- Snowball
				- 빅데이터를 물리적으로 전송하게 해준다.
			- Storage Gateway
				- iSCSI(tcp/ip를 통해) s3, s3 glacier를 다룰 수 있다.
				- linux vm img이다. 
		- database
			- DMS(Database Migration Service): server에서 rds로 지속적으로 data를 복제해서 rds로 갈아탈 수 있다.
			- Redshift
				- 싸고 빠른 dw이다.
				- sql 구문을 해석할 수 있다.
				- 분석용으로 big data도 빠르게 분석한다.
				- indexing기능이 부재하다.
		- network
			- VPC
				- server 군을 가상 subnet 관리 하에 넣을 수 있다.
				- network segment마다 방화벽, dhcp 가상 ip, nat 등을 설정할 수 있다.
			- Direct Connect
				- data center와 전용성을 끈다.
			- Route 53: dns server이다.
		- analysis
			- EMR: 
				- hadoop 전용 ec2 instance이다.
			- Data Pipeline
				- ec2에서 매일 data를 가져다가 s3에 batch해서 할 수 있다.
			- Elasticsearch Service
			- Kinesis
				- 시간당 수 tera의 data를 실시간으로 분석 가능하다.
				- json으로 던지고 ec2에서 csv로 가공후 s3에 업로드하고 redshift를 시켜 분석이 가능하다.
				- 24시간 후 data는 자연기화한다.
			- ML
				- 이항분류, 다항분류, 회귀 기능이 있다.
				- 신경망이나 deep learning 기능은 없다.
			- QuickSight
				- 비 기술자가 자신의 data를 분석하기 위한 도구이다.
				- s3와 redshift에 원시 log를 돌리면 gui에서 그래프로 볼 수 있다.
		- enterprise application
			- WorkSpaces
			- WorkMail: 다른 aws와 연동가능하고 gmail보다 저렴하다.
			- WorkDocs: 미리보기 기능은 있지만, google docs처럼 수정은 불가능하다.
		- web service
			- Mobile Hub
				- mBaaS로 다른 service를 사용할 수 있는 console이다.
				- 소셜로그인은 cognito
				- push 알림은 sns
				- site 및 contents delivery는 s3와 cloudfront
				- 사용자 data 저장은 s3
				- 분석은 mobile analytics
				- testing은 device farm
				- rest api는 lambda fn 등이 있겠다.
				- 위 정의에 따라 실제로 움직이는 sample app을 download하는 기능까지 있다.
			- Cognito: 동기화 store라는 data 저장소가 있다.
			- Device Farm: cloud로 이어진 실제 android, ios에서 app test를 할 수 있다.
			- Mobile Analytics: application에 넣어서 사용자수, 이탈율, 독자 event 등을 집계분석이 가능하다.
			- SNS
				- push 알림 service이다.
				- mail 또는 http, sms도 사용가능하다.
				- sqs와 lambda와도 연동 가능하다.  
		- iot
			- IoT
				- iot용 sdk이다
				- mqtts에 의해 보안 통신, offline 장치의 데이터 동기화 등의 역할을 한다.
		- devtools
			- CodeCommit
				- iam 역할로 관리되는 git이다.
				- web ui는 따로 없다.
			- CodeDeploy: github이나 s3에 upload하면 ec2에 자동으로 배포한다.
			- CodePipeline
				- ci도구이다.
				- git에 push하면 자동으로 build를 하고 자동 test를 시작해서 보고서를 보낸다.
		- opstools
			- CloudWatch
				- server의 사용요금과 사용량을 monitoring, graph로 그려준다.
				- sns를 통해 알림기능도 사용할 수 있다.
			- CloudFormation: 다양한 service를 일괄적으로 구축할 수 있다.
			- CloudTrail
				- aws의 작업을 기록한다.
				- 7일간 볼 수 있다.
			- Config
				- 설정변경내역을 log로 보여준다.
			- OpsWOrks
				- 작업을 자동화할 수 있다.
				- elb 및 auto scaling과는 다른방법의 scaling방법이다.
			- Service Catalog
				- cloud formation의 저장 version을 관리해준다.
				- iam 권한 없이도 사용가능하다.
			- Trusted Advisor: test를 자동화해서 비용, 성능, 보안, 가용성 및 이중화를 관리해준다.
		- securit & id
			- IAM(Identity and Access Management)
			- ACM(AWS Certificate Manager): aws 한정으로 사용할 ssl/tls 인증서를 무료로 발급해준다.
			- Directory Service: microsoft active directory가 aws에 hosting할 수 있다.
			- Inspector: ec2 보안결함을 찾아내는 자동 분석도구이다.
			- CLoudHSM: key관리에 대해 미국 정부 표준을 준수하는 hardware 기반 key storage이다.
			- KMS(Key Management Service)
				- key 관리를 해준다. 
				- cloud hsm와의 차이는 여러 지역에서 사용이 가능하지만, aws sdk를 통해 암호화 한다는 점이다.
			- WAF: 외부 access에 대한 방화벽이다.
		- application
			- AppStream
				- cloud game과 thin client system을 제공한다.
				- 내부적으로 app은 ec2에서 win2008 r2에서 시작한다.
			- CloudSearch
				- 검색서비스이다.
				- elasticsearch와 내부 engine은 같지만 cloudsearch쪽이 조금 더 편하고 성능이 낫다.
			- ELastic Transcoder: 동영상을 encoding해준다.
			- SES
				- email 송수신 server이다.
				- workmail에 던지거나 s3에 저장하거나, lambda에 던져 분석도 가능하다.
			- SNS
			- SQS
				- kinesis와 유사하지만 data를 넣는 기능만 가지고있다.
				- dropbox는 file을 저장했을때 나오는 thumbnail img에 사용한다.
				- 검색 index를 만드는데 사용도 가능하다.
		- game
			- Lumberyard
				- full source 제공의 무료 3d game engine이다.
				- open source는 아니다.
				- pc, xbox, ps, ios, andoroid를 지원하며, mac, linux도 지원예정이다.
			- GameLift: fps나 moba 등의 multiplayter의 backend를 ec2에서 띄울 수 있게 해준다.

- cloud watch
	- `Rules - Create rule`을 선택해 cronjob을 생성할 수 있다.
	<img src="https://devblog.croquis.com/img/content/2017-05-13/cloudwatch-1.png" width="500">